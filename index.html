<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìÑ PDF Splitter & Export Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f6f9;
      padding: 30px;
    }
    h1 {
      color: #2c3e50;
    }
    #pdf-upload {
      margin: 20px 0;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
      color: #007bff;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #28a745;
      color: white;
      transition: background 0.3s;
    }
    button:hover:not(:disabled) {
      background: #218838;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>üìÑ PDF Splitter & Export Tool</h1>

  <input type="file" id="pdf-upload" accept="application/pdf" />
  <br />
  <button id="export-zip" disabled>Export Pages as ZIP</button>
  <p id="status">Upload a PDF to begin.</p>

  <!-- ‚úÖ Official pdf-lib -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <!-- ‚úÖ JSZip -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <!-- ‚úÖ FileSaver -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    const { PDFDocument } = PDFLib; // ‚úÖ safe reference
    const uploadInput = document.getElementById("pdf-upload");
    const exportBtn = document.getElementById("export-zip");
    const statusText = document.getElementById("status");

    let uploadedPdfBytes = null;

    // Handle PDF Upload
    uploadInput.addEventListener("change", async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      statusText.textContent = "üì• Reading PDF...";
      uploadedPdfBytes = await file.arrayBuffer();

      statusText.textContent = `‚úÖ Loaded: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
      exportBtn.disabled = false;
    });

    // Handle Export as ZIP
    exportBtn.addEventListener("click", async () => {
      try {
        if (!uploadedPdfBytes) {
          alert("Please upload a PDF first!");
          return;
        }

        statusText.textContent = "‚è≥ Creating ZIP file...";

        const pdfDoc = await PDFDocument.load(uploadedPdfBytes);
        const totalPages = pdfDoc.getPageCount();

        const zip = new JSZip();

        for (let i = 0; i < totalPages; i++) {
          const newPdf = await PDFDocument.create();
          const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);
          newPdf.addPage(copiedPage);

          const pdfBytes = await newPdf.save();
          zip.file(`page_${i + 1}.pdf`, pdfBytes);

          statusText.textContent = `üìÑ Processing page ${i + 1} of ${totalPages}...`;
        }

        const content = await zip.generateAsync({ type: "blob" });
        saveAs(content, "split_pages.zip");

        statusText.textContent = "‚úÖ ZIP created successfully! Download started.";
      } catch (err) {
        console.error("‚ùå ZIP creation failed:", err);
        statusText.textContent = "‚ùå ZIP creation failed. Check console for details.";
      }
    });
  </script>
</body>
</html>
